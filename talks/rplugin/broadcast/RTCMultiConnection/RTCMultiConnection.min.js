"use strict";var RTCMultiConnection=function(e,n){var t;function o(e,n){function t(e){return!e.audio&&!e.video&&!e.screen&&e.data}var o="";o+="?userid="+e.userid,o+="&sessionid="+e.sessionid,o+="&msgEvent="+e.socketMessageEvent,o+="&socketCustomEvent="+e.socketCustomEvent,o+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(o+="&oneToMany=true"),o+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(o+="&enableScalableBroadcast=true",o+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),o+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(o+=e.socketCustomParameters);try{io.sockets={}}catch(e){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&("/"==e.socketURL?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",e.socketURL));try{e.socket=io(e.socketURL+o)}catch(n){e.socket=io.connect(e.socketURL+o,e.socketOptions)}var i=e.multiPeersHandler;function r(n,t){e.peersBackup[n]||(e.peersBackup[n]={userid:n,extra:{}}),e.peersBackup[n].extra=t}e.socket.on("extra-data-updated",function(n,t){e.peers[n]&&(e.peers[n].extra=t,e.onExtraDataUpdated({userid:n,extra:t}),r(n,t))}),e.socket.on(e.socketMessageEvent,function n(o){if(o.remoteUserId==e.userid)if(e.peers[o.sender]&&e.peers[o.sender].extra!=o.message.extra&&(e.peers[o.sender].extra=o.extra,e.onExtraDataUpdated({userid:o.sender,extra:o.extra}),r(o.sender,o.extra)),o.message.streamSyncNeeded&&e.peers[o.sender]){var s=e.streamEvents[o.message.streamid];if(!s||!s.stream)return;var a=o.message.action;if("ended"===a||"inactive"===a||"stream-removed"===a)return e.peersBackup[s.userid]&&(s.extra=e.peersBackup[s.userid].extra),void e.onstreamended(s);var d="both"!=o.message.type?o.message.type:null;"function"==typeof s.stream[a]&&s.stream[a](d)}else if("dropPeerConnection"!==o.message){if(o.message.allParticipants)return-1===o.message.allParticipants.indexOf(o.sender)&&o.message.allParticipants.push(o.sender),void o.message.allParticipants.forEach(function(n){i[e.peers[n]?"renegotiatePeer":"createNewPeer"](n,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:t(e.session)})});if(o.message.newParticipant){if(o.message.newParticipant==e.userid)return;if(e.peers[o.message.newParticipant])return;i.createNewPeer(o.message.newParticipant,o.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:t(e.session)})}else if(o.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia))setTimeout(function(){n(o)},1);else if(o.message.newParticipationRequest&&o.sender!==e.userid){e.peers[o.sender]&&e.deletePeer(o.sender);var c={extra:o.extra||{},localPeerSdpConstraints:o.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:o.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==o.message.isOneWay?o.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==o.message.isDataOnly?o.message.isDataOnly:t(e.session),dontGetRemoteStream:void 0!==o.message.isOneWay?o.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!o.message.dontGetRemoteStream,connectionDescription:o,successCallback:function(){}};e.onNewParticipant(o.sender,c)}else{if(o.message.changedUUID&&e.peers[o.message.oldUUID]&&(e.peers[o.message.newUUID]=e.peers[o.message.oldUUID],delete e.peers[o.message.oldUUID]),o.message.userLeft)return i.onUserLeft(o.sender),void(o.message.autoCloseEntireSession&&e.leave());i.addNegotiatedMessage(o.message,o.sender)}}else e.deletePeer(o.sender)});var s=!1;e.socket.resetProps=function(){s=!1},e.socket.on("connect",function(){s||(s=!0,e.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){e.socket.emit("extra-data-updated",e.extra)},1e3),n&&n(e.socket))}),e.socket.on("disconnect",function(n){e.onSocketDisconnect(n)}),e.socket.on("error",function(n){e.onSocketError(n)}),e.socket.on("user-disconnected",function(n){n!==e.userid&&(e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]&&e.peers[n].extra||{}}),e.deletePeer(n))}),e.socket.on("user-connected",function(n){n!==e.userid&&e.onUserStatusChanged({userid:n,status:"online",extra:e.peers[n]&&e.peers[n].extra||{}})}),e.socket.on("closed-entire-session",function(n,t){e.leave(),e.onEntireSessionClosed({sessionid:n,userid:n,extra:t})}),e.socket.on("userid-already-taken",function(n,t){e.onUserIdAlreadyTaken(n,t)}),e.socket.on("logs",function(n){e.enableLogs&&console.debug("server-logs",n)}),e.socket.on("number-of-broadcast-viewers-updated",function(n){e.onNumberOfBroadcastViewersUpdated(n)}),e.socket.on("set-isInitiator-true",function(n){n==e.sessionid&&(e.isInitiator=!0)})}function i(e){var n=this,t=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function o(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(n){e.onFileProgress(n)},e.fbr.onBegin=function(n){e.onFileStart(n)},e.fbr.onEnd=function(n){e.onFileEnd(n)}}e.peers={getLength:function(){var e=0;for(var n in this)-1==t.indexOf(n)&&e++;return e},selectFirst:function(){var e;for(var n in this)-1==t.indexOf(n)&&(e=this[n]);return e},getAllParticipants:function(e){var n=[];for(var o in this)-1==t.indexOf(o)&&o!=e&&n.push(o);return n},forEach:function(n){this.getAllParticipants().forEach(function(t){n(e.peers[t])})},send:function(t,o){var i=this;if(!f(t.size)&&!f(t.type)){if(e.enableFileSharing)return void n.shareFile(t,o);"string"!=typeof t&&(t=JSON.stringify(t))}if("text"===t.type||t instanceof ArrayBuffer||t instanceof DataView){if("text"===t.type&&(t=JSON.stringify(t)),o){var r=e.peers[o];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(t)}):(e.peers[o].createDataChannel(),e.renegotiate(o),void setTimeout(function(){i.send(t,o)},3e3))}this.getAllParticipants().forEach(function(n){if(!i[n].channels.length)return e.peers[n].createDataChannel(),e.renegotiate(n),void setTimeout(function(){i[n].channels.forEach(function(e){e.send(t)})},3e3);i[n].channels.forEach(function(e){e.send(t)})})}else D.send({text:t,channel:this,connection:e,remoteUserId:o})}},this.uuid=e.userid,this.getLocalConfig=function(t,i,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:i,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){n.onNegotiationNeeded(e,i)},onLocalCandidate:function(t){(t=E.processCandidates(e,t))&&n.onNegotiationNeeded(t,i)},remoteSdp:t,onDataChannelMessage:function(t){if(!e.fbr&&e.enableFileSharing&&o(),"string"!=typeof t&&e.enableFileSharing){var r=this;t instanceof ArrayBuffer||t instanceof DataView?e.fbr.convertToObject(t,function(e){r.onDataChannelMessage(e)}):t.readyForNextChunk?e.fbr.getNextChunk(t,function(n,t){e.peers[i].channels.forEach(function(e){e.send(n)})},i):t.chunkMissing?e.fbr.chunkMissing(t):e.fbr.addChunk(t,function(n){e.peers[i].peer.channel.send(n)})}else n.onDataChannelMessage(t,i)},onDataChannelError:function(e){n.onDataChannelError(e,i)},onDataChannelOpened:function(e){n.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){n.onDataChannelClosed(e,i)},onRemoteStream:function(t){e.peers[i]&&e.peers[i].streams.push(t),n.onGettingRemoteMedia(t,i)},onRemoteStreamRemoved:function(e){n.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){n.onPeerStateChanged(e),"new"===e.iceConnectionState&&n.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&n.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(n.onUserLeft(i),n.disconnectWith(i))}}},this.createNewPeer=function(n,t){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(t=t||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!t.streamsToShare&&(t.isOneWay=!1,t.isDataOnly=!1,t.session=e.session),!t.isOneWay&&!t.isDataOnly)return t.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:t},n);t=e.setUserPreferences(t,n);var o=this.getLocalConfig(null,n,t);e.peers[n]=new T(o)}},this.createAnsweringPeer=function(n,t,o){o=e.setUserPreferences(o||{},t);var i=this.getLocalConfig(n,t,o);e.peers[t]=new T(i)},this.renegotiatePeer=function(n,t,o){if(e.peers[n]){t||(t={}),t.renegotiatingPeer=!0,t.peerRef=e.peers[n].peer,t.channels=e.peers[n].channels;var i=this.getLocalConfig(o,n,t);e.peers[n]=new T(i)}else e.enableLogs&&console.error("Peer ("+n+") does not exist. Renegotiation skipped.")},this.replaceTrack=function(n,t,o){if(!e.peers[t])throw"This peer ("+t+") does not exist.";var i=e.peers[t].peer;i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?i.getSenders().forEach(function(i){o&&"video"===i.track.kind&&(e.peers[t].peer.lastVideoTrack=i.track,i.replaceTrack(n)),o||"audio"!==i.track.kind||(e.peers[t].peer.lastAudioTrack=i.track,i.replaceTrack(n))}):(console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(t))},this.onNegotiationNeeded=function(e,n){},this.addNegotiatedMessage=function(t,o){if(t.type&&t.sdp)return"answer"==t.type&&e.peers[o]&&e.peers[o].addRemoteSdp(t),"offer"==t.type&&(t.renegotiatingPeer?this.renegotiatePeer(o,null,t):this.createAnsweringPeer(t,o)),void(e.enableLogs&&console.log("Remote peer's sdp:",t.sdp));if(t.candidate)return e.peers[o]&&e.peers[o].addRemoteCandidate(t),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",t.candidate));if(t.enableMedia){e.session=t.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),t.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var i={};e.attachStreams.forEach(function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=i,n.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},o)}t.readyForOffer&&e.onReadyForOffer(o,t.userPreferences)},this.onGettingRemoteMedia=function(e,n){},this.onRemovingRemoteMedia=function(e,n){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(n,t){e.onMediaError(n,t)},this.shareFile=function(n,t){o(),e.fbr.readAsArrayBuffer(n,function(n){var o=e.getAllParticipants();t&&(o=[t]),o.forEach(function(t){e.fbr.getNextChunk(n,function(n){e.peers[t].channels.forEach(function(e){e.send(n)})},t)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var i=new O(e);this.onDataChannelMessage=function(n,t){i.receive(JSON.parse(n),t,e.peers[t]?e.peers[t].extra:{})},this.onDataChannelClosed=function(n,t){n.userid=t,n.extra=e.peers[t]?e.peers[t].extra:{},e.onclose(n)},this.onDataChannelError=function(n,t){n.userid=t,event.extra=e.peers[t]?e.peers[t].extra:{},e.onerror(n)},this.onDataChannelOpened=function(n,t){e.peers[t].channels.length?e.peers[t].channels=[n]:(e.peers[t].channels.push(n),e.onopen({userid:t,extra:e.peers[t]?e.peers[t].extra:{},channel:n}))},this.onPeerStateChanged=function(n){e.onPeerStateChanged(n)},this.onNegotiationStarted=function(e,n){},this.onNegotiationCompleted=function(e,n){},this.getRemoteStreams=function(n){return n=n||e.peers.getAllParticipants()[0],e.peers[n]?e.peers[n].streams:[]}}function r(e,n,t){if("undefined"!=typeof CustomEvent){var o=new CustomEvent(n,{arguments:t,__exposedProps__:t});e.dispatchEvent(o)}}function s(e,n){n.stream&&n.stream&&n.stream.addEventListener&&(n.stream.addEventListener("mute",function(t){(t=e.streamEvents[n.streamid]).session={audio:"audio"===t.muteType,video:"video"===t.muteType},e.onmute(t)},!1),n.stream.addEventListener("unmute",function(t){(t=e.streamEvents[n.streamid]).session={audio:"audio"===t.unmuteType,video:"video"===t.unmuteType},e.onunmute(t)},!1))}function a(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,o=e.length;t<o;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function d(e,n,t){if(t.autoCreateMediaElement){var o=!1;v(e,"video").length||e.isVideo||e.isScreen||(o=!0),"Firefox"===DetectRTC.browser.name&&(t.session.video||t.session.screen)&&(o=!1);var i=document.createElement(o?"audio":"video");if(i.srcObject=e,i.setAttribute("autoplay",!0),i.setAttribute("playsinline",!0),i.setAttribute("controls",!0),i.setAttribute("muted",!1),i.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var r="ended";"oninactive"in i&&(r="inactive"),i.addEventListener(r,function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){r="ended","oninactive"in e&&(r="inactive"),P.onSyncNeeded(e.streamid,r),t.attachStreams.forEach(function(n,o){e.streamid===n.streamid&&delete t.attachStreams[o]});var n=[];t.attachStreams.forEach(function(e){e&&n.push(e)}),t.attachStreams=n;var o=t.streamEvents[e.streamid];if(o)return void t.onstreamended(o);this.parentNode&&this.parentNode.removeChild(this)}},!1)}var s=i.play();if(void 0!==s){var a=!1;setTimeout(function(){a||(a=!0,n(i))},1e3),s.then(function(){a||(a=!0,n(i))}).catch(function(e){a||(a=!0,n(i))})}else n(i)}else n({})}function c(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function u(e){var n=[];return e.forEach(function(e){e&&n.push(e)}),n}function l(e){return!e.audio&&!e.video&&!e.screen&&e.data}function f(e){return void 0===e}(t="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0===global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(t.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=t.addEventListener=t.removeEventListener=function(){},t.HTMLVideoElement=t.HTMLMediaElement=function(){}),"undefined"==typeof io&&(t.io=function(){return{on:function(e,n){n=n||function(){},"connect"===e&&n()},emit:function(e,n,t){t=t||function(){},"open-room"!==e&&"join-room"!==e||t(!0,n.sessionid,null)}}}),"undefined"==typeof location&&(t.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(t.screen={width:0,height:0}),"undefined"==typeof URL&&(t.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),t.window=global),function(){var e,n="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(w="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var t=process.versions.node.toString().replace("v","");n="Nodejs/"+t+" (NodeOS) AppleWebKit/"+t+" (KHTML, like Gecko) Nodejs/"+t+" Nodejs/"+t}e="undefined"!=typeof global?global:window,"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:n,getUserMedia:function(){}},e.window=global),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}));var o=window.navigator;void 0!==o?(void 0!==o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),void 0!==o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){},userAgent:n};var i=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(o.userAgent||""),r=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),s=!!window.opera||o.userAgent.indexOf(" OPR/")>=0,a=void 0!==window.InstallTrigger,d=/^((?!chrome|android).)*safari/i.test(o.userAgent),c=!!window.chrome&&!s,u="undefined"!=typeof document&&!!document.documentMode&&!r;function l(e,n){var t=0,o=!1,i=window.setInterval(function(){e()&&(window.clearInterval(i),n(o)),t++>50&&(window.clearInterval(i),n(o=!0))},10)}var f={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return f.Android()||f.BlackBerry()||f.iOS()||f.Opera()||f.Windows()},getOsName:function(){var e="Unknown OS";return f.Android()&&(e="Android"),f.BlackBerry()&&(e="BlackBerry"),f.iOS()&&(e="iOS"),f.Opera()&&(e="Opera Mini"),f.Windows()&&(e="Windows"),e}};var m="Unknown OS",p="Unknown OS Version";var v,g,h=function(){for(var e,n=o.appVersion,t=o.userAgent,i="-",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],s=0;e=r[s];s++)if(e.r.test(t)){i=e.s;break}var a="-";switch(/Windows/.test(i)&&(/Windows (.*)/.test(i)&&(a=/Windows (.*)/.exec(i)[1]),i="Windows"),i){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(t)&&(a=/Mac OS X (10[\.\_\d]+)/.exec(t)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(t)&&(a=/Android ([\.\_\d]+)/.exec(t)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(t)&&(a=(a=/OS (\d+)_(\d+)_?(\d+)?/.exec(n))[1]+"."+a[2]+"."+(0|a[3]))}return{osName:i,osVersion:a}}();h&&h.osName&&"-"!=h.osName?(m=h.osName,p=h.osVersion):f.any()&&"Android"==(m=f.getOsName())&&(p=!!(g=(v=(v||o.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&g[1]);var w="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===m&&w&&(m="Nodejs",p=process.versions.node.toString().replace("v",""));var S=!1,C=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!S&&e in document.createElement("canvas")&&(S=!0),!C&&e in document.createElement("video")&&(C=!0))});var b=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,y=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,T=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;var R=[],E=[],x=[],M=[];o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){var n=o.mediaDevices.enumerateDevices();n&&n.then?o.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])});var P=!1;void 0!==k&&"getSources"in k?P=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(P=!0);var O=!1,D=!1,A=!1,L=!1,U=!1;function I(e){if(P)if(!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices){R=[],E=[],x=[],M=[],O=!1,D=!1,A=!1,L=!1,U=!1;var n={};o.enumerateDevices(function(t){t.forEach(function(e){var t={};for(var o in e)try{"function"!=typeof e[o]&&(t[o]=e[o])}catch(e){}n[t.deviceId+t.label+t.kind]||("audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label?("videoinput"!==t.kind||U||(U=!0),"audioinput"!==t.kind||L||(L=!0)):(t.isCustomLabel=!0,"videoinput"===t.kind?t.label="Camera "+(M.length+1):"audioinput"===t.kind?t.label="Microphone "+(E.length+1):"audiooutput"===t.kind?t.label="Speaker "+(x.length+1):t.label="Please invoke getUserMedia once.",void 0!==N&&N.browser.isChrome&&N.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(t.label="HTTPs is required to get label of this "+t.kind+" device.")),"audioinput"===t.kind&&(O=!0,-1===E.indexOf(t)&&E.push(t)),"audiooutput"===t.kind&&(D=!0,-1===x.indexOf(t)&&x.push(t)),"videoinput"===t.kind&&(A=!0,-1===M.indexOf(t)&&M.push(t)),R.push(t),n[t.deviceId+t.label+t.kind]=t)}),void 0!==N&&(N.MediaDevices=R,N.hasMicrophone=O,N.hasSpeakers=D,N.hasWebcam=A,N.isWebsiteHasWebcamPermissions=U,N.isWebsiteHasMicrophonePermissions=L,N.audioInputDevices=E,N.audioOutputDevices=x,N.videoInputDevices=M),e&&e()})}else e&&e();else e&&e()}var N=window.DetectRTC||{};N.browser=function(){o.appVersion;var e,n,t,i=o.userAgent,l=o.appName,f=""+parseFloat(o.appVersion),m=parseInt(o.appVersion,10);if(d&&!c&&-1!==i.indexOf("CriOS")&&(d=!1,c=!0),s){l="Opera";try{m=(f=o.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){f="0.0.0.0",m=0}}else u?((n=i.indexOf("rv:"))>0?f=i.substring(n+3):(n=i.indexOf("MSIE"),f=i.substring(n+5)),l="IE"):c?(n=i.indexOf("Chrome"),l="Chrome",f=i.substring(n+7)):d?(n=i.indexOf("Safari"),l="Safari",f=i.substring(n+7),-1!==(n=i.indexOf("Version"))&&(f=i.substring(n+8)),-1!==o.userAgent.indexOf("Version/")&&(f=o.userAgent.split("Version/")[1].split(" ")[0])):a?(n=i.indexOf("Firefox"),l="Firefox",f=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(l=i.substring(e,n),f=i.substring(n+1),l.toLowerCase()===l.toUpperCase()&&(l=o.appName));return r&&(l="Edge",f=o.userAgent.split("Edge/")[1]),-1!==(t=f.search(/[; \)]/))&&(f=f.substring(0,t)),m=parseInt(""+f,10),isNaN(m)&&(f=""+parseFloat(o.appVersion),m=parseInt(o.appVersion,10)),{fullVersion:f,version:m,name:l,isPrivateBrowsing:!1}}(),function(e){var n;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){n=!1},function(e){n=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var t;try{(t=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){n=!0}void 0===n&&l(function(){return"done"===t.readyState},function(e){e||(n=!t.result)})}else if(function(e){var n=e.toLowerCase();if(0===n.indexOf("msie")&&0===n.indexOf("trident"))return!1;var t=/(?:msie|rv:)\s?([\d\.]+)/.exec(n);return!!(t&&parseInt(t[1],10)>=10)}(window.navigator.userAgent)){n=!1;try{window.indexedDB||(n=!0)}catch(e){n=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){n=!0}void 0===n&&(n=!1,window.localStorage.removeItem("test"))}}catch(e){n=!1}l(function(){return void 0!==n},function(t){e(n)})}(function(e){N.browser.isPrivateBrowsing=!!e}),N.browser["is"+N.browser.name]=!0,N.osName=m,N.osVersion=p;"object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"];var W=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){W||e in window&&(W=!0)}),N.isWebRTCSupported=W,N.isORTCSupported="undefined"!=typeof RTCIceGatherer;var V=!1;(N.browser.isChrome&&N.browser.version>=35?V=!0:N.browser.isFirefox&&N.browser.version>=34?V=!0:N.browser.isEdge&&N.browser.version>=17?V=!0:"Android"===N.osName&&N.browser.isChrome&&(V=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(N.browser.isChrome||N.browser.isEdge||N.browser.isOpera)?V=!1:N.browser.isFirefox&&(V=!1));N.isScreenCapturingSupported=V;var B={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){B.isSupported||e in window&&(B.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(B.isCreateMediaStreamSourceSupported=!0))}),N.isAudioContextSupported=B.isSupported,N.isCreateMediaStreamSourceSupported=B.isCreateMediaStreamSourceSupported;var F=!1;N.browser.isChrome&&N.browser.version>31&&(F=!0),N.isRtpDataChannelsSupported=F;var q=!1;N.browser.isFirefox&&N.browser.version>28?q=!0:N.browser.isChrome&&N.browser.version>25?q=!0:N.browser.isOpera&&N.browser.version>=11&&(q=!0),N.isSctpDataChannelsSupported=q,N.isMobileDevice=i;var G=!1;o.getUserMedia?G=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(G=!0),N.browser.isChrome&&N.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(G="Requires HTTPs"),"Nodejs"===N.osName&&(G=!1),N.isGetUserMediaSupported=G;var j,H,z,_="";screen.width&&(_+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));N.displayResolution=_,N.displayAspectRatio=(j=screen.width,H=screen.height,z=function e(n,t){return 0==t?n:e(t,n%t)}(j,H),j/z/(H/z)).toFixed(2),N.isCanvasSupportsStreamCapturing=S,N.isVideoSupportsStreamCapturing=C,"Chrome"==N.browser.name&&N.browser.version>=53&&(N.isCanvasSupportsStreamCapturing||(N.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),N.isVideoSupportsStreamCapturing||(N.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),N.DetectLocalIPAddress=function(e,n){if(N.isWebRTCSupported){var t=!0,o=!0;!function(e,n){if("undefined"!=typeof document&&"function"==typeof document.getElementById){var t={},o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!o){var i=document.getElementById("iframe");if(!i)return;var r=i.contentWindow;o=r.RTCPeerConnection||r.mozRTCPeerConnection||r.webkitRTCPeerConnection}if(o){var s=null;"Chrome"===N.browser&&N.browser.version<58&&(s={optional:[{RtpDataChannels:!0}]});var a=new o({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},s);if(n&&(a.addStream?a.addStream(n):a.addTrack&&n.getTracks()[0]&&a.addTrack(n.getTracks()[0],n)),a.onicecandidate=function(e){e.candidate&&e.candidate.candidate?d(e.candidate.candidate):d()},!n)try{a.createDataChannel("sctp",{})}catch(e){}N.isPromisesSupported?a.createOffer().then(function(e){a.setLocalDescription(e).then(c)}):a.createOffer(function(e){a.setLocalDescription(e,c,function(){})},function(){})}}function d(n){if(n){var o=y.exec(n);if(o){var i=o[1],r=n.match(b);void 0===t[i]&&e(i,r,!0),t[i]=!0}}else e()}function c(){var e=a.localDescription.sdp.split("\n");e.forEach(function(e){e&&0===e.indexOf("a=candidate:")&&d(e)})}}(function(n){n?n.match(b)?e("Local: "+n,t=!1,o):n.match(T)?e("Public: "+n,t,o=!1):e("Public: "+n,t,o):e()},n)}},N.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,N.isWebSocketsBlocked=!N.isWebSocketsSupported,"Nodejs"===N.osName&&(N.isWebSocketsSupported=!0,N.isWebSocketsBlocked=!1),N.checkWebSocketsSupport=function(e){e=e||function(){};try{var n,t=new WebSocket("wss://echo.websocket.org:443/");t.onopen=function(){N.isWebSocketsBlocked=!1,n=(new Date).getTime(),t.send("ping")},t.onmessage=function(){N.WebsocketLatency=(new Date).getTime()-n+"ms",e(),t.close(),t=null},t.onerror=function(){N.isWebSocketsBlocked=!0,e()}}catch(n){N.isWebSocketsBlocked=!0,e()}},N.load=function(e){I(e=e||function(){})},N.MediaDevices=void 0!==R?R:[],N.hasMicrophone=O,N.hasSpeakers=D,N.hasWebcam=A,N.isWebsiteHasWebcamPermissions=U,N.isWebsiteHasMicrophonePermissions=L,N.audioInputDevices=E,N.audioOutputDevices=x,N.videoInputDevices=M;var J=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(J=!0),N.isSetSinkIdSupported=J;var X=!1;N.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(X=!0):N.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(X=!0),N.isRTPSenderReplaceTracksSupported=X;var K=!1;N.browser.isFirefox&&N.browser.version>38&&(K=!0),N.isRemoteStreamProcessingSupported=K;var Y=!1;void 0!==k&&"applyConstraints"in k.prototype&&(Y=!0),N.isApplyConstraintsSupported=Y;var $=!1;N.browser.isFirefox&&N.browser.version>=43&&($=!0),N.isMultiMonitorScreenCapturingSupported=$,N.isPromisesSupported=!!("Promise"in window),N.version="1.3.9",void 0===N&&(window.DetectRTC={});var Q=window.MediaStream;void 0===Q&&"undefined"!=typeof webkitMediaStream&&(Q=webkitMediaStream),N.MediaStream=void 0!==Q&&"function"==typeof Q&&Object.keys(Q.prototype),N.MediaStreamTrack=void 0!==k&&Object.keys(k.prototype);var Z=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;N.RTCPeerConnection=void 0!==Z&&Object.keys(Z.prototype),window.DetectRTC=N,"undefined"!=typeof module&&(module.exports=N),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return N})}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.attachEventListener=function(e,n,t,o){e.addEventListener(n,t,o)};var m=window.MediaStream;function p(e,n){return(!e.session.audio||"two-way"!==e.session.audio)&&("Firefox"===DetectRTC.browser.name&&!1!==n||!("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50)&&(!0===typeof n||!(void 0!==n||!e.session.audio||!e.session.screen||e.session.video)&&(n=!0,!0)))}function v(e,n){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(n||"audio")}):[]}function g(){var e=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n=new w;try{n.addTransceiver("audio"),e=!0}catch(e){}n.close()}catch(n){e=!1}return e&&function(){var e=!1;try{var n=new w({sdpSemantics:"unified-plan"});try{var t=n.getConfiguration();e="unified-plan"==t.sdpSemantics||(t.sdpSemantics,!1)}catch(n){e=!1}}catch(n){e=!1}return e}()}function h(){if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}void 0===m&&"undefined"!=typeof webkitMediaStream&&(m=webkitMediaStream),void 0!==m&&("stop"in m.prototype||(m.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",h,!1),h();var w,S={};function C(e){return{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}}void 0!==window.RTCPeerConnection?w=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?w=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(w=webkitRTCPeerConnection);var b=window.RTCSessionDescription||window.mozRTCSessionDescription,y=window.RTCIceCandidate||window.mozRTCIceCandidate,k=window.MediaStreamTrack;function T(e){if(void 0!==window.RTCPeerConnection?w=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?w=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(w=webkitRTCPeerConnection),b=window.RTCSessionDescription||window.mozRTCSessionDescription,y=window.RTCIceCandidate||window.mozRTCIceCandidate,k=window.MediaStreamTrack,!w)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var n=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:n.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){n.addStream(e,t.userid)},this.removeStream=function(e){n.removeStream(e,t.userid)};var t=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var o,i={};S.sdpConstraints=C({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var r=!!e.renegotiatingPeer;e.remoteSdp&&(r=!!e.remoteSdp.renegotiatingPeer);var s=[];if(n.attachStreams.forEach(function(e){e&&s.push(e)}),r)o=e.peerRef;else{var a="all";(n.candidates.turn||n.candidates.relay)&&(n.candidates.stun||n.candidates.reflexive||n.candidates.host||(a="relay"));try{var d={iceServers:n.iceServers,iceTransportPolicy:n.iceTransportPolicy||a};void 0!==n.iceCandidatePoolSize&&(d.iceCandidatePoolSize=n.iceCandidatePoolSize),void 0!==n.bundlePolicy&&(d.bundlePolicy=n.bundlePolicy),void 0!==n.rtcpMuxPolicy&&(d.rtcpMuxPolicy=n.rtcpMuxPolicy),n.sdpSemantics&&(d.sdpSemantics=n.sdpSemantics||"unified-plan"),n.iceServers&&n.iceServers.length||(d=null,n.optionalArgument=null),o=new w(d,n.optionalArgument)}catch(e){try{d={iceServers:n.iceServers};o=new w(d)}catch(e){o=new w}}}!o.getRemoteStreams&&o.getReceivers&&(o.getRemoteStreams=function(){var e=new m;return o.getReceivers().forEach(function(n){e.addTrack(n.track)}),[e]}),!o.getLocalStreams&&o.getSenders&&(o.getLocalStreams=function(){var e=new m;return o.getSenders().forEach(function(n){e.addTrack(n.track)}),[e]}),o.onicecandidate=function(i){if(i.candidate)n.trickleIce&&e.onLocalCandidate({candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex});else if(!n.trickleIce){var r=o.localDescription;e.onLocalSdp({type:r.type,sdp:r.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:t.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:n?n.extra:{},streamsToShare:p})}},s.forEach(function(i){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(i=n.beforeAddingStream(i,t))&&(o.getLocalStreams().forEach(function(e){i&&e.id==i.id&&(i=null)}),i&&i.getTracks&&i.getTracks().forEach(function(e){try{o.addTrack(e,i)}catch(e){}}))}),o.oniceconnectionstatechange=o.onsignalingstatechange=function(){if("stable"==t.signalingState){var i=t.extra;n.peers[t.userid]&&(i=n.peers[t.userid].extra||i),o&&(e.onPeerStateChanged({iceConnectionState:o.iceConnectionState,iceGatheringState:o.iceGatheringState,signalingState:o.signalingState,extra:i,userid:t.userid}),o&&o.iceConnectionState&&-1!==o.iceConnectionState.search(/closed|failed/gi)&&t.streams instanceof Array&&t.streams.forEach(function(e){var t=n.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};n.onstreamended(t)}))}else console.log("Negotiation skipped in stable")};var c={OfferToReceiveAudio:!!s.length,OfferToReceiveVideo:!!s.length};e.localPeerSdpConstraints&&(c=e.localPeerSdpConstraints),S.sdpConstraints=C(c);var u={};o.ontrack=function(n){if(n&&"track"===n.type)if(n.stream=n.streams[n.streams.length-1],n.stream.id||(n.stream.id=n.track.id),u[n.stream.id]&&"Safari"!==DetectRTC.browser.name)n.track&&(n.track.onended=function(){o&&o.onremovestream(n)});else{u[n.stream.id]=n.stream.id;var t={};e.remoteSdp&&e.remoteSdp.streamsToShare?t=e.remoteSdp.streamsToShare:e.streamsToShare&&(t=e.streamsToShare);var r=t[n.stream.id];r?(n.stream.isAudio=r.isAudio,n.stream.isVideo=r.isVideo,n.stream.isScreen=r.isScreen):(n.stream.isVideo=!!v(n.stream,"video").length,n.stream.isAudio=!n.stream.isVideo,n.stream.isScreen=!1),n.stream.streamid=n.stream.id,i[n.stream.id]=n.stream,e.onRemoteStream(n.stream),n.stream.getTracks().forEach(function(e){e.onended=function(){o&&o.onremovestream(n)}}),n.stream.onremovetrack=function(){o&&o.onremovestream(n)}}},o.onremovestream=function(n){n.stream.streamid=n.stream.id,i[n.stream.id]&&delete i[n.stream.id],e.onRemoteStreamRemoved(n.stream)},"function"!=typeof o.removeStream&&(o.removeStream=function(e){e.getTracks().forEach(function(n){o.removeTrack(n,e)})}),this.addRemoteCandidate=function(e){o.addIceCandidate(new y(e))},this.addRemoteSdp=function(e,t){t=t||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=n.processSdp(e.sdp)),o.setRemoteDescription(new b(e)).then(t,function(o){n.enableLogs&&console.error("setRemoteDescription failed","\n",o,"\n",e.sdp),t()}).catch(function(o){n.enableLogs&&console.error("setRemoteDescription failed","\n",o,"\n",e.sdp),t()})};var l=!0;function f(n){n.binaryType="arraybuffer",n.onmessage=function(n){e.onDataChannelMessage(n.data)},n.onopen=function(){e.onDataChannelOpened(n)},n.onerror=function(n){e.onDataChannelError(n)},n.onclose=function(n){e.onDataChannelClosed(n)},n.internalSend=n.send,n.send=function(e){"open"===n.readyState&&n.internalSend(e)},o.channel=n}e.remoteSdp&&(l=!1),this.createDataChannel=function(){f(o.createDataChannel("sctp",{}))},!0!==n.session.data||r||(l?this.createDataChannel():o.ondatachannel=function(e){f(e.channel)}),this.enableDisableVideoEncoding=function(e){var n;if(o.getSenders().forEach(function(e){n||"video"!==e.track.kind||(n=e)}),n&&n.getParameters){var t=n.getParameters();t.encodings[1]&&(t.encodings[1].active=!!e),t.encodings[2]&&(t.encodings[2].active=!!e),n.setParameters(t)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(c=e.remoteSdp.remotePeerSdpConstraints),S.sdpConstraints=C(c),this.addRemoteSdp(e.remoteSdp,function(){g("createAnswer")})),"two-way"!=n.session.audio&&"two-way"!=n.session.video&&"two-way"!=n.session.screen||(S.sdpConstraints=C({OfferToReceiveAudio:"two-way"==n.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==n.session.video||"two-way"==n.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var p={};function g(i){o[i](S.sdpConstraints).then(function(i){"Safari"!==DetectRTC.browser.name&&(i.sdp=n.processSdp(i.sdp)),o.setLocalDescription(i).then(function(){n.trickleIce&&(e.onLocalSdp({type:i.type,sdp:i.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:t.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:n?n.extra:{},streamsToShare:p}),n.onSettingLocalDescription(t))},function(e){n.enableLogs&&console.error("setLocalDescription error",e)})},function(e){n.enableLogs&&console.error("sdp-error",e)})}o.getLocalStreams().forEach(function(e){p[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),l&&g("createOffer"),o.nativeClose=o.close,o.close=function(){if(o){try{o.nativeClose!==o.close&&o.nativeClose()}catch(e){}o=null,t.peer=null}},this.peer=o}var R=function(){function e(e,o){var i=t(e);return i.videoCodecNumbers?"vp8"===o&&i.vp8LineNumber===i.videoCodecNumbers[0]?e:"vp9"===o&&i.vp9LineNumber===i.videoCodecNumbers[0]?e:"h264"===o&&i.h264LineNumber===i.videoCodecNumbers[0]?e:e=n(e,o,i):e}function n(e,n,t,o){var i="";if("vp8"===n){if(!t.vp8LineNumber)return e;i=t.vp8LineNumber}if("vp9"===n){if(!t.vp9LineNumber)return e;i=t.vp9LineNumber}if("h264"===n){if(!t.h264LineNumber)return e;i=t.h264LineNumber}var r=t.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",s=[i];return o&&(s=[]),t.videoCodecNumbers.forEach(function(e){e!==i&&s.push(e)}),r+=s.join(" "),e=e.replace(t.videoCodecNumbersOriginal,r)}function t(e){var n={};return e.split("\n").forEach(function(e){0===e.indexOf("m=video")&&(n.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach(function(t){(t=t.trim())&&t.length&&(n.videoCodecNumbers.push(t),n.videoCodecNumbersOriginal=e)})),-1===e.indexOf("VP8/90000")||n.vp8LineNumber||(n.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||n.vp9LineNumber||(n.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||n.h264LineNumber||(n.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])}),n}function o(e,n,t){return function(e,n,t,o,i){for(var r=-1!==t?t:e.length,s=n;s<r;++s)if(0===e[s].indexOf(o)&&(!i||-1!==e[s].toLowerCase().indexOf(i.toLowerCase())))return s;return null}(e,0,-1,n,t)}function i(e){var n=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),t=e.match(n);return t&&2===t.length?t[1]:null}return{removeVPX:function(e){var o=t(e);return e=n(e,"vp9",o,!0),e=n(e,"vp8",o,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,n){if(n&&n.getSenders&&n.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";n.getSenders().forEach(function(n){for(var t=n.getParameters(),o=0;o<t.codecs.length;o++)if(t.codecs[o].mimeType==e){t.codecs.unshift(t.codecs.splice(o,1));break}n.setParameters(t)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,n,t){return function(e,n,t){return n?"undefined"!=typeof isFirefox&&isFirefox?e:(t&&(n.screen?n.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&t&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n"):n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.video+"\r\n")),e):e}(e,n,t)},setVideoBitrates:function(e,n){return function(e,n){var t,r=(n=n||{}).min,s=n.max,a=e.split("\r\n"),d=o(a,"a=rtpmap","VP8/90000");if(d&&(t=i(a[d])),!t)return e;var c,u=o(a,"a=rtpmap","rtx/90000");if(u&&(c=i(a[u])),!u)return e;var l=o(a,"a=fmtp:"+c.toString());if(null!==l){var f="\r\n";f+="a=fmtp:"+t+" x-google-min-bitrate="+(r||"228")+"; x-google-max-bitrate="+(s||"228"),a[l]=a[l].concat(f),e=a.join("\r\n")}return e}(e,n)},setOpusAttributes:function(e,n){return function(e,n){n=n||{};var t,r=e.split("\r\n"),s=o(r,"a=rtpmap","opus/48000");if(s&&(t=i(r[s])),!t)return e;var a=o(r,"a=fmtp:"+t.toString());if(null===a)return e;var d="";return d+="; stereo="+(void 0!==n.stereo?n.stereo:"1"),d+="; sprop-stereo="+(void 0!==n["sprop-stereo"]?n["sprop-stereo"]:"1"),void 0!==n.maxaveragebitrate&&(d+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),void 0!==n.maxplaybackrate&&(d+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),void 0!==n.cbr&&(d+="; cbr="+(void 0!==n.cbr?n.cbr:"1")),void 0!==n.useinbandfec&&(d+="; useinbandfec="+n.useinbandfec),void 0!==n.usedtx&&(d+="; usedtx="+n.usedtx),void 0!==n.maxptime&&(d+="\r\na=maxptime:"+n.maxptime),r[a]=r[a].concat(d),e=r.join("\r\n")}(e,n)},preferVP9:function(n){return e(n,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var n=e.split("\r\n"),t=null,o=0;o<n.length;o++)if(-1!==n[o].search("opus/48000")){var i=extractSdp(n[o],/:(\d+) opus\/48000/i);break}for(o=0;o<n.length;o++)if(-1!==n[o].search("a=fmtp")&&extractSdp(n[o],/a=fmtp:(\d+)/)===i){t=o;break}return null===t?e:(n[t]=n[t].concat("; stereo=1; sprop-stereo=1"),e=n.join("\r\n"))}}}();window.BandwidthHandler=R;var E=function(){return{processCandidates:function(e,n){var t=n.candidate,o=e.candidates,i=o.stun,r=o.turn;if(f(o.reflexive)||(i=o.reflexive),f(o.relay)||(r=o.relay),(o.host||!t.match(/typ host/g))&&(r||!t.match(/typ relay/g))&&(i||!t.match(/typ srflx/g))){var s=e.iceProtocols;if((s.udp||!t.match(/ udp /g))&&(s.tcp||!t.match(/ tcp /g)))return e.enableLogs&&console.debug("Your candidate pairs:",t),{candidate:t,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}}}}}(),x=function(){return{getIceServers:function(e){return[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]}}}();function M(e){if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var n=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[n])r(currentUserMediaRequest.streams[n].stream,!0);else{if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=n,r(e)},function(n){e.onLocalMediaError(n,e.localMediaConstraints)});if(void 0===navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var t,o,i=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),t=stream},function(e){i(e),o=e}),{then:function(e){if(!t)return e,{then:function(e){o?e(o):i=e}};e(t)}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=n,r(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)});else{if(!navigator.getDisplayMedia)throw new Error("getDisplayMedia API is not availabe in this browser.");navigator.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=n,r(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=n,r(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}}else currentUserMediaRequest.queueRequests.push(e);function r(t,o){!function(e,n){e.mandatory&&e.mandatory.chromeMediaSource?n.isScreen=!0:e.mozMediaSource||e.mediaSource?n.isScreen=!0:e.video?n.isVideo=!0:e.audio&&(n.isAudio=!0)}(e.localMediaConstraints,t);var i="ended";"oninactive"in t&&(i="inactive"),t.addEventListener(i,function(){delete currentUserMediaRequest.streams[n],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=u(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[n]={stream:t},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&M(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(t,o)}}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var n=this.streams[e];if(n){var t=(n=n.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(t)&&(delete this.queueRequests[this.queueRequests.indexOf(t)],this.queueRequests=u(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var P=function(){function e(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}return{setHandlers:function(n,t,o){if(n&&n.addEventListener){if(void 0===t||1==t){var i="ended";"oninactive"in n&&(i="inactive"),n.addEventListener(i,function(){P.onSyncNeeded(this.streamid,i)},!1)}n.mute=function(i,s){i=e(i),void 0!==s&&(t=s),void 0!==i&&"audio"!=i||v(n,"audio").forEach(function(e){e.enabled=!1,o.streamEvents[n.streamid].isAudioMuted=!0}),void 0!==i&&"video"!=i||v(n,"video").forEach(function(e){e.enabled=!1}),void 0!==t&&1!=t||P.onSyncNeeded(n.streamid,"mute",i),o.streamEvents[n.streamid].muteType=i||"both",r(n,"mute",i)},n.unmute=function(i,s){i=e(i),void 0!==s&&(t=s),function(){if(o.streamEvents[n.streamid].mediaElement){var e=o.streamEvents[n.streamid].mediaElement;e.volume=0,function e(n,t,o,i){(i=(i||0)+1)>=t||setTimeout(function(){o(),e(n,t,o,i)},n)}(200,5,function(){try{e.volume+=.2}catch(n){e.volume=1}})}}(),void 0!==i&&"audio"!=i||v(n,"audio").forEach(function(e){e.enabled=!0,o.streamEvents[n.streamid].isAudioMuted=!1}),void 0!==i&&"video"!=i||(v(n,"video").forEach(function(e){e.enabled=!0}),void 0!==i&&"video"==i&&o.streamEvents[n.streamid].isAudioMuted&&function e(t){t||(t=0),++t<100&&o.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout(function(){e(t)},50))}()),void 0!==t&&1!=t||P.onSyncNeeded(n.streamid,"unmute",i),o.streamEvents[n.streamid].unmuteType=i||"both",r(n,"unmute",i)}}},onSyncNeeded:function(e,n,t){}}}();function O(e){var n={};return{receive:function(t,o,i){var r=t.uuid;if(n[r]||(n[r]=[]),n[r].push(t.message),t.last){var s=n[r].join("");t.isobject&&(s=JSON.parse(s));var a={data:s,userid:o,extra:i,latency:(new Date).getTime()-t.sendingTime};e.autoTranslateText?(a.original=a.data,e.Translator.TranslateText(a.data,function(n){a.data=n,e.onmessage(a)})):e.onmessage(a),delete n[r]}}}}var D={send:function(e){var n=e.connection,t=e.channel,o=e.remoteUserId,i=e.text,r=n.chunkSize||1e3,s="",d=!1;"string"!=typeof i&&(d=!0,i=JSON.stringify(i));var c=a(),u=(new Date).getTime();!function e(i,a){var l={type:"text",uuid:c,sendingTime:u};i&&(a=i,l.packets=parseInt(a.length/r));a.length>r?l.message=a.slice(0,r):(l.message=a,l.last=!0,l.isobject=d);t.send(l,o);s=a.slice(l.message.length);s.length&&setTimeout(function(){e(null,s)},n.chunkInterval||100)}(i)}},A=function(){return{handle:function(e){var n={};e.onFileStart=function(t){var o=document.createElement("div");if(o.title=t.name,o.innerHTML="<label>0%</label> <progress></progress>",t.remoteUserId&&(o.innerHTML+=" (Sharing with:"+t.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(o,e.filesContainer.firstChild),!t.remoteUserId)return n[t.uuid]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(n[t.uuid].progress.max=t.maxChunks);n[t.uuid]||(n[t.uuid]={}),n[t.uuid][t.remoteUserId]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},n[t.uuid][t.remoteUserId].progress.max=t.maxChunks},e.onFileProgress=function(e){var t=n[e.uuid];t&&(e.remoteUserId&&!(t=n[e.uuid][e.remoteUserId])||(t.progress.value=e.currentPosition||e.maxChunks||t.progress.max,function(e,n){if(-1!==e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}(t.progress,t.label)))},e.onFileEnd=function(e){var t=n[e.uuid];if(t){if(!e.remoteUserId||(t=n[e.uuid][e.remoteUserId])){var o=t.div;-1!=e.type.indexOf("image")?o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}else console.error("No such progress-helper element exist.",e)}}}}(),L=function(){return{handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(n,t){var o=document.createElement("script");o.type="text/javascript";var i=encodeURIComponent(n),r="method"+e.token();window[r]=function(e){e.data&&e.data.translations[0]&&t?t(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):e.error?console.error(e.error.message):console.error(e)};var s="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+i;o.src=s,document.getElementsByTagName("head")[0].appendChild(o)},getListOfLanguages:function(n){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState==XMLHttpRequest.DONE){var e=JSON.parse(t.responseText);if(e&&e.data&&e.data.languages)return void n(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error('Text translation failed. Error message: "Daily Limit Exceeded."');if(e.error)return void console.error(e.error.message);console.error(e)}};var o="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";t.open("GET",o,!0),t.send(null)}}}}}();!function(t){n=n||{useDefaultDevices:!0},t.channel=t.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var r=new i(t),u={};function f(e){if(t.socketAutoReConnect=!0,t.socket)e&&e(t.socket);else{if(void 0===o)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new o(t,function(n){e&&e(t.socket)})}}function h(e,n){t.socket.emit("join-room",{sessionid:t.sessionid,session:t.session,mediaConstraints:t.mediaConstraints,sdpConstraints:t.sdpConstraints,streams:C(),extra:t.extra,password:void 0!==t.password&&"object"!=typeof t.password?t.password:""},function(o,i){if(!0===o){if(t.enableLogs&&console.log("isRoomJoined: ",o," roomid: ",t.sessionid),t.peers[t.sessionid])return;r.onNegotiationNeeded(e)}!1===o&&t.enableLogs&&console.warn("isRoomJoined: ",i," roomid: ",t.sessionid),n(o,t.sessionid,i)})}function S(e){t.enableLogs&&console.log("Sending open-room signal to socket.io"),t.waitingForLocalMedia=!1,t.socket.emit("open-room",{sessionid:t.sessionid,session:t.session,mediaConstraints:t.mediaConstraints,sdpConstraints:t.sdpConstraints,streams:C(),extra:t.extra,identifier:t.publicRoomIdentifier,password:void 0!==t.password&&"object"!=typeof t.password?t.password:""},function(n,o){!0===n&&(t.enableLogs&&console.log("isRoomOpened: ",n," roomid: ",t.sessionid),e(n,t.sessionid)),!1===n&&(t.enableLogs&&console.warn("isRoomOpened: ",o," roomid: ",t.sessionid),e(n,t.sessionid,o))})}function C(){try{return t.streamEvents.selectAll("local").map(function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}})}catch(e){return[]}}function b(e,n){if(t.dontCaptureUserMedia||e.isDataOnly)n();else{var o={};e.localPeerSdpConstraints.OfferToReceiveAudio&&(o.audio=t.mediaConstraints.audio),e.localPeerSdpConstraints.OfferToReceiveVideo&&(o.video=t.mediaConstraints.video);var i=e.session||t.session;i.oneway&&"two-way"!==i.audio&&"two-way"!==i.video&&"two-way"!==i.screen?n():(i.oneway&&i.audio&&"two-way"===i.audio&&(i={audio:!0}),(i.audio||i.video||i.screen)&&(i.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:p(t)}).then(function(e){e.isScreen=!0,r.onGettingLocalMedia(e),!i.audio&&!i.video||p(t)?n(e):t.invokeGetUserMedia(null,n)},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.invokeGetUserMedia({audio:p(t),video:!0,isScreen:!0},!i.audio&&!i.video||p(t)?n:t.invokeGetUserMedia(null,n)):(i.audio||i.video)&&t.invokeGetUserMedia(null,n,i)))}}function y(e,n){e?(n.audio&&v(e,"audio").forEach(function(e){e.applyConstraints(n.audio)}),n.video&&v(e,"video").forEach(function(e){e.applyConstraints(n.video)})):t.enableLogs&&console.error("No stream to applyConstraints.")}function T(e,n,o){n?r.replaceTrack(e,n,o):t.peers.getAllParticipants().forEach(function(n){r.replaceTrack(e,n,o)})}r.onGettingLocalMedia=function(e,n){if(n=n||function(){},u[e.streamid])n();else{u[e.streamid]=!0;try{e.type="local"}catch(e){}t.setStreamEndHandler(e),d(e,function(o){o.id=e.streamid,o.muted=!0,o.volume=0,-1===t.attachStreams.indexOf(e)&&t.attachStreams.push(e),void 0!==P&&P.setHandlers(e,!0,t),t.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:o,userid:t.userid,extra:t.extra,streamid:e.streamid,isAudioMuted:!0};try{!function(e,n){if(n.stream&&v(n.stream,"audio").length){if(!e||!n)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(n.stream,{onspeaking:function(){e.onspeaking(n)},onsilence:function(){e.onsilence(n)},onvolumechange:function(t,o){e.onvolumechange&&e.onvolumechange(merge({volume:t,threshold:o},n))}})}}}(t,t.streamEvents[e.streamid]),s(t,t.streamEvents[e.streamid]),t.onstream(t.streamEvents[e.streamid])}catch(e){}n()},t)}},r.onGettingRemoteMedia=function(e,n){try{e.type="remote"}catch(e){}t.setStreamEndHandler(e,"remote-stream"),d(e,function(o){o.id=e.streamid,void 0!==P&&P.setHandlers(e,!1,t),t.streamEvents[e.streamid]={stream:e,type:"remote",userid:n,extra:t.peers[n]?t.peers[n].extra:{},mediaElement:o,streamid:e.streamid},s(t,t.streamEvents[e.streamid]),t.onstream(t.streamEvents[e.streamid])},t)},r.onRemovingRemoteMedia=function(e,n){var o=t.streamEvents[e.streamid];o||(o={stream:e,type:"remote",userid:n,extra:t.peers[n]?t.peers[n].extra:{},streamid:e.streamid,mediaElement:t.streamEvents[e.streamid]?t.streamEvents[e.streamid].mediaElement:null}),t.peersBackup[o.userid]&&(o.extra=t.peersBackup[o.userid].extra),t.onstreamended(o),delete t.streamEvents[e.streamid]},r.onNegotiationNeeded=function(e,n,o){o=o||function(){};var i={remoteUserId:n=n||e.remoteUserId,message:e=e||"",sender:t.userid};e.remoteUserId&&e.message&&e.sender&&(i=e),f(function(){t.socket.emit(t.socketMessageEvent,i,o)})},r.onUserLeft=function(e){t.deletePeer(e)},r.disconnectWith=function(e,n){t.socket&&t.socket.emit("disconnect-with",e,n||function(){}),t.deletePeer(e)},t.socketOptions={transport:"polling"},t.openOrJoin=function(e,n){n=n||function(){},t.checkPresence(e,function(e,o){if(e){t.sessionid=o;var i,r,s=!!t.session.oneway,a=l(t.session);r={OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},i={OfferToReceiveAudio:s?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:s?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo};var d={remoteUserId:t.sessionid,message:{newParticipationRequest:!0,isOneWay:s,isDataOnly:a,localPeerSdpConstraints:i,remotePeerSdpConstraints:r},sender:t.userid};b(d.message,function(){h(d,n)})}else t.waitingForLocalMedia=!0,t.isInitiator=!0,t.sessionid=o||t.sessionid,l(t.session)?S(n):t.captureUserMedia(function(){S(n)})})},t.waitingForLocalMedia=!1,t.open=function(e,n){n=n||function(){},t.waitingForLocalMedia=!0,t.isInitiator=!0,t.sessionid=e||t.sessionid,f(function(){l(t.session)?S(n):t.captureUserMedia(function(){S(n)})})},t.peersBackup={},t.deletePeer=function(e){if(e&&t.peers[e]){var n={userid:e,extra:t.peers[e]?t.peers[e].extra:{}};if(t.peersBackup[n.userid]&&(n.extra=t.peersBackup[n.userid].extra),t.onleave(n),t.peers[e]){t.peers[e].streams.forEach(function(e){e.stop()});var o=t.peers[e].peer;if(o&&"closed"!==o.iceConnectionState)try{o.close()}catch(e){}t.peers[e]&&(t.peers[e].peer=null,delete t.peers[e])}}},t.rejoin=function(e){if(!t.isInitiator&&e&&Object.keys(e).length){var n={};t.peers[e.remoteUserId]&&(n=t.peers[e.remoteUserId].extra,t.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(t.join(e.remoteUserId),t.onReConnecting({userid:e.remoteUserId,extra:n}))}},t.join=function(e,n){t.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||t.sessionid,t.sessionid+="";var o=!1,i=!1,r=!1,s=!1;if(e&&e.session||!e||"string"==typeof e){var a=e&&e.session||t.session;r=!!a.oneway,s=l(a),i={OfferToReceiveAudio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:t.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:r?!!t.session.audio:t.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!t.session.video||!!t.session.screen:t.sdpConstraints.mandatory.OfferToReceiveVideo}}var d=function(){};"function"==typeof(n=n||{})&&(d=n,n={}),void 0!==n.localPeerSdpConstraints&&(o=n.localPeerSdpConstraints),void 0!==n.remotePeerSdpConstraints&&(i=n.remotePeerSdpConstraints),void 0!==n.isOneWay&&(r=n.isOneWay),void 0!==n.isDataOnly&&(s=n.isDataOnly);var c={remoteUserId:t.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:s,localPeerSdpConstraints:o,remotePeerSdpConstraints:i},sender:t.userid};return b(c.message,function(){f(function(){h(c,d)})}),c},t.publicRoomIdentifier="",t.getUserMedia=t.captureUserMedia=function(e,n){e=e||function(){};var o=n||t.session;t.dontCaptureUserMedia||l(o)?e():(o.audio||o.video||o.screen)&&(o.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:p(t)}).then(function(i){if(i.isScreen=!0,r.onGettingLocalMedia(i),!o.audio&&!o.video||p(t))e(i);else{var s={};for(var a in o)"screen"!==a&&(s[a]=o[a]);t.invokeGetUserMedia(n,e,s)}},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.invokeGetUserMedia({audio:p(t),video:!0,isScreen:!0},function(i){if(!o.audio&&!o.video||p(t))e(i);else{var r={};for(var s in o)"screen"!==s&&(r[s]=o[s]);t.invokeGetUserMedia(n,e,r)}}):(o.audio||o.video)&&t.invokeGetUserMedia(n,e,o))},t.onbeforeunload=function(e,n){t.closeBeforeUnload&&(t.peers.getAllParticipants().forEach(function(e){r.onNegotiationNeeded({userLeft:!0},e),t.peers[e]&&t.peers[e].peer&&t.peers[e].peer.close(),delete t.peers[e]}),n||t.closeSocket(),t.isInitiator=!1)},window.ignoreBeforeUnload?t.closeBeforeUnload=!1:(t.closeBeforeUnload=!0,window.addEventListener("beforeunload",t.onbeforeunload,!1)),t.userid=a(),t.changeUserId=function(e,n){n=n||function(){},t.userid=e||a(),t.socket.emit("changed-uuid",t.userid,n)},t.extra={},t.attachStreams=[],t.session={audio:!0,video:!0},t.enableFileSharing=!1,t.bandwidth={screen:!1,audio:!1,video:!1},t.codecs={audio:"opus",video:"VP9"},t.processSdp=function(e){return g()?e:"Safari"===DetectRTC.browser.name?e:("VP8"===t.codecs.video.toUpperCase()&&(e=R.preferCodec(e,"vp8")),"VP9"===t.codecs.video.toUpperCase()&&(e=R.preferCodec(e,"vp9")),"H264"===t.codecs.video.toUpperCase()&&(e=R.preferCodec(e,"h264")),"G722"===t.codecs.audio&&(e=R.removeNonG722(e)),"Firefox"===DetectRTC.browser.name?e:((t.bandwidth.video||t.bandwidth.screen)&&(e=R.setApplicationSpecificBandwidth(e,t.bandwidth,!!t.session.screen)),t.bandwidth.video&&(e=R.setVideoBitrates(e,{min:8*t.bandwidth.video*1024,max:8*t.bandwidth.video*1024})),t.bandwidth.audio&&(e=R.setOpusAttributes(e,{maxaveragebitrate:8*t.bandwidth.audio*1024,maxplaybackrate:8*t.bandwidth.audio*1024,stereo:1,maxptime:3})),e))},void 0!==R&&(t.BandwidthHandler=t.CodecsHandler=R),t.mediaConstraints={audio:{mandatory:{},optional:t.bandwidth.audio?[{bandwidth:8*t.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:t.bandwidth.video?[{bandwidth:8*t.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(t.mediaConstraints={audio:!0,video:!0}),n.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){var e,n;if(DetectRTC.MediaDevices.forEach(function(o){"audioinput"===o.kind&&!1!==t.mediaConstraints.audio&&(e=o),"videoinput"===o.kind&&!1!==t.mediaConstraints.video&&(n=o)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==t.mediaConstraints.audio?t.mediaConstraints.audio.deviceId=e.id:t.mediaConstraints.audio={deviceId:e.id});1==t.mediaConstraints.audio&&(t.mediaConstraints.audio={mandatory:{},optional:[]}),t.mediaConstraints.audio.optional||(t.mediaConstraints.audio.optional=[]);var o=[{sourceId:e.id}];t.mediaConstraints.audio.optional=o.concat(t.mediaConstraints.audio.optional)}if(n){if("Firefox"===DetectRTC.browser.name)return void(!0!==t.mediaConstraints.video?t.mediaConstraints.video.deviceId=n.id:t.mediaConstraints.video={deviceId:n.id});1==t.mediaConstraints.video&&(t.mediaConstraints.video={mandatory:{},optional:[]}),t.mediaConstraints.video.optional||(t.mediaConstraints.video.optional=[]);o=[{sourceId:n.id}];t.mediaConstraints.video.optional=o.concat(t.mediaConstraints.video.optional)}}),t.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},t.sdpSemantics=null,t.iceCandidatePoolSize=null,t.bundlePolicy=null,t.rtcpMuxPolicy=null,t.iceTransportPolicy=null,t.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},t.iceServers=x.getIceServers(t),t.candidates={host:!0,stun:!0,turn:!0},t.iceProtocols={tcp:!0,udp:!0},t.onopen=function(e){t.enableLogs&&console.info("Data connection has been opened between you & ",e.userid)},t.onclose=function(e){t.enableLogs&&console.warn("Data connection has been closed between you & ",e.userid)},t.onerror=function(e){t.enableLogs&&console.error(e.userid,"data-error",e)},t.onmessage=function(e){t.enableLogs&&console.debug("data-message",e.userid,e.data)},t.send=function(e,n){t.peers.send(e,n)},t.close=t.disconnect=t.leave=function(){t.onbeforeunload(!1,!0)},t.closeEntireSession=function(e){e=e||function(){},t.socket.emit("close-entire-session",function n(){t.getAllParticipants().length?setTimeout(n,100):(t.onEntireSessionClosed({sessionid:t.sessionid,userid:t.userid,extra:t.extra}),t.changeUserId(null,function(){t.close(),e()}))})},t.onEntireSessionClosed=function(e){t.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},t.onstream=function(e){var n=t.videosContainer;n.insertBefore(e.mediaElement,n.firstChild);var o=e.mediaElement.play();void 0===o?setTimeout(function(){e.mediaElement.play()},2e3):o.catch(function(){}).then(function(){setTimeout(function(){e.mediaElement.play()},2e3)})},t.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},t.direction="many-to-many",t.removeStream=function(e,n){var o;t.attachStreams.forEach(function(n){n.id===e&&(o=n)}),o?(t.peers.getAllParticipants().forEach(function(e){if(!n||e===n){var i=t.peers[e];try{i.peer.removeStream(o)}catch(e){}}}),t.renegotiate()):console.warn("No such stream exist.",e)},t.addStream=function(e,n){if(e.getTracks)return-1===t.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),t.attachStreams.push(e)),void t.renegotiate(n);function o(o){e.streamCallback&&e.streamCallback(o),t.renegotiate(n)}l(e)?t.renegotiate(n):(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:p(t)}).then(function(n){n.isScreen=!0,r.onGettingLocalMedia(n),!e.audio&&!e.video||p(t)?o(n):t.invokeGetUserMedia(null,function(e){o(e)})},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.invokeGetUserMedia({audio:p(t),video:!0,isScreen:!0},function(n){!e.audio&&!e.video||p(t)?o(n):t.invokeGetUserMedia(null,function(e){o(e)})}):(e.audio||e.video)&&t.invokeGetUserMedia(null,o))},t.invokeGetUserMedia=function(e,n,o){o||(o=t.session),e||(e=t.mediaConstraints),M({onGettingLocalMedia:function(t){var o=e.video;o&&(o.mediaSource||o.mozMediaSource?t.isScreen=!0:o.mandatory&&o.mandatory.chromeMediaSource&&(t.isScreen=!0)),t.isScreen||(t.isVideo=!!v(t,"video").length,t.isAudio=!t.isVideo&&v(t,"audio").length),r.onGettingLocalMedia(t,function(){"function"==typeof n&&n(t)})},onLocalMediaError:function(e,n){r.onLocalMediaError(e,n)},localMediaConstraints:e||{audio:!!o.audio&&e.audio,video:!!o.video&&e.video}})},t.applyConstraints=function(e,n){if(k&&k.prototype.applyConstraints){var o;if(n)return t.streamEvents[n]&&(o=t.streamEvents[n].stream),void y(o,e);t.attachStreams.forEach(function(n){y(n,e)})}else alert("track.applyConstraints is NOT supported in your browser.")},t.replaceTrack=function(e,n,o){if(e=e||{},w.prototype.getSenders)if(e instanceof k)T(e,n,o);else{if(e instanceof m)return v(e,"video").length&&T(v(e,"video")[0],n,!0),void(v(e,"audio").length&&T(v(e,"audio")[0],n,!1));if(l(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:p(t)}).then(function(n){n.isScreen=!0,r.onGettingLocalMedia(n),!e.audio&&!e.video||p(t)?i(n):t.invokeGetUserMedia(null,i)},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):t.invokeGetUserMedia({audio:p(t),video:!0,isScreen:!0},!e.audio&&!e.video||p(t)?i:t.invokeGetUserMedia(null,i)):(e.audio||e.video)&&t.invokeGetUserMedia(null,i))}else t.addStream(e);function i(i){t.replaceTrack(i,n,o||e.video||e.screen)}},t.resetTrack=function(e,n){e||(e=t.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var o=t.peers[e].peer;void 0!==n&&!0!==n||!o.lastVideoTrack||t.replaceTrack(o.lastVideoTrack,e,!0),void 0!==n&&!1!==n||!o.lastAudioTrack||t.replaceTrack(o.lastAudioTrack,e,!1)})},t.renegotiate=function(e){e?r.renegotiatePeer(e):t.peers.getAllParticipants().forEach(function(e){r.renegotiatePeer(e)})},t.setStreamEndHandler=function(e,n){if(e&&e.addEventListener&&(n=!!n,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var o="ended";"oninactive"in e&&(o="inactive"),e.addEventListener(o,function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!n){var o=[];t.attachStreams.forEach(function(n){n.id!=e.id&&o.push(n)}),t.attachStreams=o}var i=t.streamEvents[e.streamid];if(i||(i={stream:e,streamid:e.streamid,type:n?"remote":"local",userid:t.userid,extra:t.extra,mediaElement:t.streamEvents[e.streamid]?t.streamEvents[e.streamid].mediaElement:null}),n&&t.peers[i.userid]){var r=t.peers[i.userid].peer;o=[];r.getRemoteStreams().forEach(function(n){n.id!=e.id&&o.push(n)}),t.peers[i.userid].streams=o}i.userid===t.userid&&"remote"===i.type||(t.peersBackup[i.userid]&&(i.extra=t.peersBackup[i.userid].extra),t.onstreamended(i),delete t.streamEvents[e.streamid])},!1)}},t.onMediaError=function(e,n){t.enableLogs&&console.error(e,n)},t.autoCloseEntireSession=!1,t.filesContainer=t.videosContainer=document.body||document.documentElement,t.isInitiator=!1,t.shareFile=r.shareFile,void 0!==A&&A.handle(t),void 0!==L&&L.handle(t),t.token=a,t.onNewParticipant=function(e,n){t.acceptParticipationRequest(e,n)},t.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),r.createNewPeer(e,n)},void 0!==P&&(t.StreamsHandler=P),t.onleave=function(e){},t.invokeSelectFileDialog=function(e){var n=new FileSelector;n.accept="*.*",n.selectSingleFile(e)},t.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var n=e.mediaElement.pause();void 0!==n?n.then(function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},t.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},t.onExtraDataUpdated=function(e){e.status="online",t.onUserStatusChanged(e,!0)},t.getAllParticipants=function(e){return t.peers.getAllParticipants(e)},void 0!==P&&(P.onSyncNeeded=function(e,n,o){t.peers.getAllParticipants().forEach(function(t){r.onNegotiationNeeded({streamid:e,action:n,streamSyncNeeded:!0,type:o||"both"},t)})}),t.connectSocket=function(e){f(e)},t.closeSocket=function(){try{io.sockets={}}catch(e){}t.socket&&("function"==typeof t.socket.disconnect&&t.socket.disconnect(),"function"==typeof t.socket.resetProps&&t.socket.resetProps(),t.socket=null)},t.getSocket=function(e){return!e&&t.enableLogs&&console.warn("getSocket.callback paramter is required."),e=e||function(){},t.socket?e(t.socket):f(function(){e(t.socket)}),t.socket},t.getRemoteStreams=r.getRemoteStreams;var E=["selectFirst","selectAll","forEach"];if(t.streamEvents={selectFirst:function(e){return t.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var n=[];return Object.keys(t.streamEvents).forEach(function(o){var i=t.streamEvents[o];if(-1===E.indexOf(o)){var r=!0;e.local&&"local"===i.type&&(r=!1),e.remote&&"remote"===i.type&&(r=!1),e.isScreen&&i.stream.isScreen&&(r=!1),e.isVideo&&i.stream.isVideo&&(r=!1),e.isAudio&&i.stream.isAudio&&(r=!1),e.userid&&i.userid===e.userid&&(r=!1),!1===r&&n.push(i)}}),n}},t.socketURL="/",t.socketMessageEvent="RTCMultiConnection-Message",t.socketCustomEvent="RTCMultiConnection-Custom-Message",t.DetectRTC=DetectRTC,t.setCustomSocketEvent=function(e){e&&(t.socketCustomEvent=e),t.socket&&t.socket.emit("set-custom-socket-event-listener",t.socketCustomEvent)},t.getNumberOfBroadcastViewers=function(e,n){t.socket&&e&&n&&t.socket.emit("get-number-of-users-in-specific-broadcast",e,n)},t.onNumberOfBroadcastViewersUpdated=function(e){t.enableLogs&&t.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},t.onUserStatusChanged=function(e,n){t.enableLogs&&!n&&console.info(e.userid,e.status)},t.getUserMediaHandler=M,t.multiPeersHandler=r,t.enableLogs=!0,t.setCustomSocketHandler=function(e){void 0!==o&&(o=e)},t.chunkSize=4e4,t.maxParticipantsAllowed=1e3,t.disconnectWith=r.disconnectWith,t.checkPresence=function(e,n){e=e||t.sessionid,"SSEConnection"!==o.name?t.socket?t.socket.emit("check-presence",e+"",function(e,o,i){t.enableLogs&&console.log("checkPresence.isRoomExist: ",e," roomid: ",o),n(e,o,i)}):t.connectSocket(function(){t.checkPresence(e,n)}):SSEConnection.checkPresence(e,function(e,o,i){if(!t.socket)return e||(t.userid=o),void t.connectSocket(function(){n(e,o,i)});n(e,o)})},t.onReadyForOffer=function(e,n){t.multiPeersHandler.createNewPeer(e,n)},t.setUserPreferences=function(e){return t.dontAttachStream&&(e.dontAttachLocalStream=!0),t.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},t.updateExtraData=function(){t.socket.emit("extra-data-updated",t.extra)},t.enableScalableBroadcast=!1,t.maxRelayLimitPerUser=3,t.dontCaptureUserMedia=!1,t.dontAttachStream=!1,t.dontGetRemoteStream=!1,t.onReConnecting=function(e){t.enableLogs&&console.info("ReConnecting with",e.userid,"...")},t.beforeAddingStream=function(e){return e},t.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(t.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(t.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(t.getChromeExtensionStatus=getChromeExtensionStatus),t.modifyScreenConstraints=function(e){return e},t.onPeerStateChanged=function(e){t.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},t.isOnline=!0,c("online",function(){t.isOnline=!0}),c("offline",function(){t.isOnline=!1}),t.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(t.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),t.isLowBandwidth)){if(t.bandwidth={audio:!1,video:!1,screen:!1},t.mediaConstraints.audio&&t.mediaConstraints.audio.optional&&t.mediaConstraints.audio.optional.length){var O=[];t.mediaConstraints.audio.optional.forEach(function(e){void 0===e.bandwidth&&O.push(e)}),t.mediaConstraints.audio.optional=O}if(t.mediaConstraints.video&&t.mediaConstraints.video.optional&&t.mediaConstraints.video.optional.length){O=[];t.mediaConstraints.video.optional.forEach(function(e){void 0===e.bandwidth&&O.push(e)}),t.mediaConstraints.video.optional=O}}t.getExtraData=function(e,n){if(!e)throw"remoteUserId is required.";if("function"!=typeof n)return t.peers[e]?t.peers[e].extra:t.peersBackup[e]?t.peersBackup[e].extra:{};t.socket.emit("get-remote-user-extra-data",e,function(e,t,o){n(e,t,o)})},n.autoOpenOrJoin&&t.openOrJoin(t.sessionid),t.onUserIdAlreadyTaken=function(e,n){t.close(),t.closeSocket(),t.isInitiator=!1,t.userid=t.token(),t.join(t.sessionid),t.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",t.userid)},t.trickleIce=!0,t.version="3.6.9",t.onSettingLocalDescription=function(e){t.enableLogs&&console.info("Set local description for remote user",e.userid)},t.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},t.autoCreateMediaElement=!0,t.password=null,t.setPassword=function(e,n){n=n||function(){},t.socket?t.socket.emit("set-password",e,n):(t.password=e,n(!0,t.sessionid,null))},t.onSocketDisconnect=function(e){t.enableLogs&&console.warn("socket.io connection is closed")},t.onSocketError=function(e){t.enableLogs&&console.warn("socket.io connection is failed")},t.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}}(this)};"undefined"!=typeof module&&(module.exports=exports=RTCMultiConnection),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],function(){return RTCMultiConnection});